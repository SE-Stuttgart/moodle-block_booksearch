define("block_booksearch/search",["exports","block_booksearch/display"],(function(_exports,_display){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(label){chapterLabel=label;document.getElementById("bs-search-input").addEventListener("input",handleSearchInputChange)};
/**
   * Block core and UI
   *
   * @module     block_booksearch/search
   * @copyright  2024 University of Stuttgart <kasra.habib@iste.uni-stuttgart.de>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
let chapterLabel="Chapter";function handleSearchInputChange(event){const searchTerm=event.target.value,searchTermLabel=document.getElementById("bs-search-term-label").value,courseContent=JSON.parse(atob(document.getElementById("bs-json-course-content").value));let searchResults=[];searchTerm&&(searchResults=function(courseContent,searchTerm,contextLength){const results={};return courseContent.forEach((section=>{const context=function(content,searchTerm,contextLength){const searchContent=content.toLowerCase();if(searchTerm=searchTerm.toLowerCase(),-1===searchContent.indexOf(searchTerm))return"";const occurrenceIndexes=function(text,term){const occurrences=[],termLength=term.length;let index,offset=0;for(;-1!==(index=text.indexOf(term,offset));){const occurrence={start:index,end:index+termLength};occurrences.push(occurrence),offset=index+1}return occurrences}(searchContent,searchTerm),[words,wordIndexes]=function(text){const words=[],wordIndexes=[],regex=/\S+/g;let match;for(;null!==(match=regex.exec(text));)words.push(match[0]),wordIndexes.push(match.index);return[words,wordIndexes]}(content),contextPositions=function(occurrences,wordIndexes,contextLength){let occurrenceContextPositions=function(occurrences,wordIndexes,contextLength){const results=[];let currentOccurrenceIndex=0;for(let wordNumber=0;wordNumber<wordIndexes.length&&!(currentOccurrenceIndex>=occurrences.length);wordNumber++){if(wordNumber+1>=wordIndexes.length){const start=Math.max(0,wordNumber-contextLength),length=null;results.push({start:start,end:length});continue}const currentOccurrence=occurrences[currentOccurrenceIndex];if(wordIndexes[wordNumber+1]<=currentOccurrence.start)continue;const position={start:Math.max(0,wordNumber-contextLength),end:getContextEnd(wordIndexes,wordNumber,currentOccurrence.end,contextLength)};results.push(position),currentOccurrenceIndex++}return results}(occurrences,wordIndexes,contextLength);return occurrenceContextPositions=function(contextPositions){const results=[];for(let i=0;i<contextPositions.length;i++){let position=contextPositions[i],start=position.start,end=position.end;for(;i+1<contextPositions.length&&contextPositions[i].end&&contextPositions[i].end>=contextPositions[i+1].start;)end=contextPositions[i+1].end,i++;const mergedPosition={start:start,end:null!==end?end+1:void 0};if(results.push(mergedPosition),!end)break}return results}(occurrenceContextPositions),occurrenceContextPositions}(occurrenceIndexes,wordIndexes,contextLength);return function(words,contextPositions){let context="... ";return contextPositions.forEach((position=>{const subcontextWords=words.slice(position.start,position.end);context+=subcontextWords.join(" "),context+=" ... "})),context}(words,contextPositions)}(section.content,searchTerm,contextLength);section.context=context,context.length<1||(results.hasOwnProperty(section.filename)||(results[section.filename]={}),results[section.filename].hasOwnProperty(section.page)?results[section.filename][section.page].context+=section.context:results[section.filename][section.page]={bookurl:section.bookurl,context:section.context})})),results}(courseContent,searchTerm,5)),document.getElementById("bs-search-term").innerHTML=searchTermLabel+searchTerm,(0,_display.displayResults)(document.getElementById("bs-content"),searchResults,chapterLabel)}function getContextEnd(wordIndexes,startNumber,endIndex,contextLength){for(let i=startNumber;i<wordIndexes.length;i++){if(i+contextLength+1>=wordIndexes.length)return null;if(wordIndexes[i+1]<=endIndex)continue;return i+contextLength}return null}}));

//# sourceMappingURL=search.min.js.map