define("block_booksearch/search_and_display",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=function(label){chapterLabel=label;document.getElementById("bs-search-input").addEventListener("input",handleSearchInputChange)};
/**
   * Block core and UI
   *
   * @module     block_booksearch/search_and_display
   * @copyright  2024 University of Stuttgart <kasra.habib@iste.uni-stuttgart.de>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
let chapterLabel="Chapter";function handleSearchInputChange(event){const searchTerm=event.target.value,searchTermLabel=document.getElementById("bs-search-term-label").value,courseContent=JSON.parse(atob(document.getElementById("bs-json-course-content").value));let searchResults=[];searchTerm&&courseContent.forEach((section=>function(section,searchTerm,contextLength,searchResults){const content=section.content.toLowerCase(),term=searchTerm.toLowerCase();if(!content.includes(term))return;const occuranceRanges=function(positions,length){if(0===positions.length)return[];const result=[];let currentStart=positions[0],currentEnd=currentStart+length;for(let i=1;i<positions.length;i++)currentEnd>=positions[i]?currentEnd=positions[i]+length:(result.push([currentStart,currentEnd]),currentStart=positions[i],currentEnd=currentStart+length);return result.push([currentStart,currentEnd]),result}(function(content,term){const occurances=[];let startIndex=0;for(;-1!==(startIndex=content.indexOf(term,startIndex));)occurances.push(startIndex),startIndex+=1;return occurances}(content,term),term.length),contextWords=function(words,occurrences){const result=[];let currentOccurrenceIndex=0,[currentOccurrenceStart,currentOccurrenceEnd]=occurrences.length>0?occurrences[0]:[-1,-1],currentOccurrenceWords=[],resultIndexCounter=0;for(let wordIndex=0;wordIndex<words.length;wordIndex++){const[wordStart,word]=words[wordIndex],wordEnd=wordStart+word.length;-1!==currentOccurrenceEnd?wordEnd<currentOccurrenceStart?result.push([!1,resultIndexCounter++,word]):wordEnd>=currentOccurrenceStart&&wordStart<=currentOccurrenceEnd?currentOccurrenceWords.push(word):wordStart>currentOccurrenceEnd&&(result.push([!0,resultIndexCounter++,currentOccurrenceWords.join(" ")]),currentOccurrenceWords=[],currentOccurrenceIndex++,currentOccurrenceIndex<occurrences.length?[currentOccurrenceStart,currentOccurrenceEnd]=occurrences[currentOccurrenceIndex]:[currentOccurrenceStart,currentOccurrenceEnd]=[-1,-1],wordIndex--):result.push([!1,resultIndexCounter++,word])}currentOccurrenceWords.length>0&&result.push([!0,resultIndexCounter++,currentOccurrenceWords.join(" ")]);return result}(function(text){const words=[],regex=/\S+/g;let match;for(;null!==(match=regex.exec(text));)words.push([match.index,match[0]]);return words}(content),occuranceRanges),contextSnippetIndexes=function(contextWords,contextLength){const occurrences=[];let currentOccurrenceStart=-2*contextLength,currentOccurrenceEnd=-2*contextLength;for(let i=0;i<contextWords.length;i++){const[isOccurrence,index]=contextWords[i];if(!isOccurrence)continue;const start=Math.max(0,index-contextLength),end=Math.min(contextWords.length-1,index+contextLength);currentOccurrenceEnd>=start-1?currentOccurrenceEnd=end:(occurrences.push([currentOccurrenceStart,currentOccurrenceEnd]),currentOccurrenceStart=start,currentOccurrenceEnd=end)}return occurrences.push([currentOccurrenceStart,currentOccurrenceEnd]),occurrences.shift(),occurrences}(contextWords,contextLength),contextSnippets=function(contextWords,contextSnippetIndexes){const result=[];for(let i=0;i<contextSnippetIndexes.length;i++){const[start,end]=contextSnippetIndexes[i],words=[];for(let index=start;index<=end;index++)words.push(contextWords[index][2]);result.push(words.join(" "))}return result}(contextWords,contextSnippetIndexes),result=function(contextWords,contextSnippetIndexes,contextSnippets){let result=contextSnippets.join(" ... ");contextSnippetIndexes[0][0]>0&&(result="... "+result);contextSnippetIndexes[contextSnippetIndexes.length-1][1]<contextWords.length-1&&(result+=" ...");return result}(contextWords,contextSnippetIndexes,contextSnippets);section.context=result,section.filename in searchResults||(searchResults[section.filename]=[]);section.page in searchResults[section.filename]?searchResults[section.filename][section.page].context+=" ... "+section.context:searchResults[section.filename][section.page]=section}(section,searchTerm,5,searchResults))),document.getElementById("bs-search-term").innerHTML=searchTermLabel+searchTerm,document.getElementById("bs-content").innerHTML=function(searchResults){let display="";for(var pdfName in searchResults){for(var chapter in display+="<h4>"+pdfName+"</h4>",display+='<ul class="bs-content-element">',searchResults[pdfName])display+='<li><a href="'+searchResults[pdfName][chapter].bookurl+'">'+chapterLabel+"-"+chapter+"</a>: "+searchResults[pdfName][chapter].context+"</li>";display+="</ul>"}return display}(searchResults)}}));

//# sourceMappingURL=search_and_display.min.js.map